<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDMAX PROMPT INDONESIA - Generator Prompt AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #3949ab;
            --accent-color: #5c6bc0;
            --light-color: #e8eaf6;
            --dark-color: #212121;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --poster-color: #e91e63;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 3rem 0;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .hero h1 {
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 2.5rem;
        }
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .container-custom {
            max-width: 1000px;
            margin: 2rem auto;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary-color);
        }
        .card-poster {
            border-left: 5px solid var(--poster-color);
        }
        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        .form-control, .form-select, .form-textarea {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 0.75rem;
        }
        .form-control:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.25rem rgba(92, 107, 192, 0.25);
        }
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        .btn-poster {
            background-color: var(--poster-color);
            border-color: var(--poster-color);
        }
        .btn-poster:hover {
            background-color: #c2185b;
            border-color: #c2185b;
        }
        .btn-copy {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .btn-copy:hover {
            background-color: var(--secondary-color);
            color: white;
        }
        .result-container {
            margin-top: 2rem;
            display: none;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .result-title {
            font-weight: 600;
            color: var(--primary-color);
        }
        .footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(26, 35, 126, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .custom-toast {
            background-color: var(--success-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .api-key-container {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .api-key-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .api-key-header i {
            color: var(--warning-color);
            margin-right: 0.5rem;
        }
        .specialization-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .specialization-chip {
            background-color: var(--light-color);
            border-radius: 20px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }
        .specialization-chip.active {
            background-color: var(--accent-color);
            color: white;
        }
        .poster-category-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .poster-category-item {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .poster-category-item:hover {
            background-color: var(--accent-color);
            color: white;
        }
        .poster-category-item.selected {
            background-color: var(--poster-color);
            color: white;
        }
        .tab-container {
            margin-bottom: 1.5rem;
        }
        .nav-tabs {
            border-bottom: 2px solid var(--light-color);
        }
        .nav-tabs .nav-link {
            color: var(--secondary-color);
            font-weight: 500;
            border: none;
            border-bottom: 3px solid transparent;
            border-radius: 0;
            padding: 0.75rem 1rem;
        }
        .nav-tabs .nav-link:hover {
            border-bottom-color: var(--accent-color);
            color: var(--primary-color);
        }
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom-color: var(--primary-color);
        }
        .tab-content {
            padding: 1.5rem 0;
        }
        .input-with-suggestion {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .suggestion-trigger {
            display: flex;
            justify-content: flex-end;
            margin-top: 0.5rem;
        }
        .suggestion-area {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            display: none;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .suggestion-area.active {
            display: flex;
        }
        .suggestion-text {
            flex-grow: 1;
            font-style: normal;
            color: var(--primary-color);
            line-height: 1.4;
        }
        .suggestion-text span {
            display: inline-block;
            background-color: #bbdefb;
            border-radius: 5px;
            padding: 0.3rem 0.6rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin: 2px;
        }
        .suggestion-text span:hover {
            background-color: #90caf9;
        }
        .btn-suggest-ai {
            white-space: nowrap;
        }
        .suggestion-loading {
            display: none;
            margin-left: 1rem;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="hero">
        <div class="container">
            <h1><i class="fas fa-magic"></i> VDMAX PROMPT INDONESIA</h1>
            <p>Generator prompt profesional dengan "Logika Pintar" Gemini untuk menghasilkan gambar AI ultra-realistis</p>
        </div>
    </div>

    <div class="container container-custom">
        <div class="card">
            <h3 class="mb-4"><i class="fas fa-cogs"></i> Pengaturan Generator Prompt</h3>
            <div class="api-key-container">
                <div class="api-key-header">
                    <i class="fas fa-key"></i>
                    <strong>Kunci API Gemini</strong>
                </div>
                <p class="mb-2">Masukkan kunci API Gemini Anda untuk menggunakan generator ini.</p>
                <div class="input-group">
                    <input type="password" class="form-control" id="apiKey" placeholder="Masukkan kunci API Gemini Anda">
                    <button class="btn btn-outline-secondary" type="button" id="toggleApiKey">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                <small class="text-muted">Kunci API Anda akan disimpan secara lokal di browser Anda.</small>
            </div>

            <div class="tab-container">
                <ul class="nav nav-tabs" id="promptTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="single-image-tab" data-bs-toggle="tab" data-bs-target="#single-image" type="button" role="tab" aria-controls="single-image" aria-selected="true">
                            <i class="fas fa-image me-2"></i> Gambar Tunggal
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="poster-tab" data-bs-toggle="tab" data-bs-target="#poster" type="button" role="tab" aria-controls="poster" aria-selected="false">
                            <i class="fas fa-ad me-2"></i> Poster Promosi
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="promptTabsContent">
                    <!-- Single Image Tab -->
                    <div class="tab-pane fade show active" id="single-image" role="tabpanel" aria-labelledby="single-image-tab">
                        <div class="mb-3 input-with-suggestion">
                            <label for="subject" class="form-label">Subjek yang Diinginkan</label>
                            <input type="text" class="form-control" id="subject" placeholder="Contoh: wanita berpakaian tradisional di sawah">
                            <small class="text-muted">Jelaskan subjek atau objek yang ingin Anda hasilkan gambarnya.</small>
                            <div class="suggestion-trigger">
                                <button type="button" class="btn btn-outline-info btn-sm btn-suggest-ai" data-target="subject">
                                    <i class="fas fa-lightbulb me-1"></i> Saran AI
                                </button>
                            </div>
                            <div class="suggestion-area" id="suggestion-subject">
                                <span class="suggestion-text"></span>
                                <div class="suggestion-loading"></div>
                            </div>
                        </div>
                        <div class="mb-3 input-with-suggestion">
                            <label for="negativePrompt" class="form-label">Prompt Negatif (Opsional)</label>
                            <textarea class="form-control" id="negativePrompt" rows="3" placeholder="Contoh: teks, tanda air, buram, cacat"></textarea>
                            <small class="text-muted">Jelaskan hal-hal yang TIDAK ingin Anda lihat dalam gambar yang dihasilkan.</small>
                            <div class="suggestion-trigger">
                                <button type="button" class="btn btn-outline-info btn-sm btn-suggest-ai" data-target="negativePrompt">
                                    <i class="fas fa-lightbulb me-1"></i> Saran AI
                                </button>
                            </div>
                            <div class="suggestion-area" id="suggestion-negativePrompt">
                                <span class="suggestion-text"></span>
                                <div class="suggestion-loading"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Gaya Visual</label>
                            <div class="specialization-options">
                                <div class="specialization-chip active" data-style="magazine"><i class="fas fa-book me-1"></i> Magazine</div>
                                <div class="specialization-chip" data-style="netflix"><i class="fas fa-film me-1"></i> Netflix</div>
                                <div class="specialization-chip" data-style="korean"><i class="fas fa-heart me-1"></i> Korean Drama</div>
                                <div class="specialization-chip" data-style="kpop"><i class="fas fa-music me-1"></i> K-Pop</div>
                                <div class="specialization-chip" data-style="hollywood"><i class="fas fa-star me-1"></i> Hollywood</div>
                                <div class="specialization-chip" data-style="espn"><i class="fas fa-football-ball me-1"></i> ESPN</div>
                                <div class="specialization-chip" data-style="natgeo"><i class="fas fa-globe-americas me-1"></i> National Geographic</div>
                            </div>
                            <small class="text-muted">Pilih gaya visual yang Anda inginkan untuk gambar yang dihasilkan.</small>
                        </div>
                        <div class="mb-3">
                            <label for="promptCount" class="form-label">Jumlah Prompt</label>
                            <select class="form-select" id="promptCount">
                                <option value="1">1 Prompt</option>
                                <option value="3" selected>3 Prompt</option>
                                <option value="5">5 Prompt</option>
                            </select>
                        </div>
                    </div>

                    <!-- Poster Tab -->
                    <div class="tab-pane fade" id="poster" role="tabpanel" aria-labelledby="poster-tab">
                        <div class="mb-3 input-with-suggestion">
                            <label for="posterProduct" class="form-label">Produk/Jasa yang Dipromosikan</label>
                            <input type="text" class="form-control" id="posterProduct" placeholder="Contoh: Kopi Bahagia">
                            <small class="text-muted">Nama produk atau jasa yang ingin Anda promosikan.</small>
                            <div class="suggestion-trigger">
                                <button type="button" class="btn btn-outline-info btn-sm btn-suggest-ai" data-target="posterProduct">
                                    <i class="fas fa-lightbulb me-1"></i> Saran AI
                                </button>
                            </div>
                            <div class="suggestion-area" id="suggestion-posterProduct">
                                <span class="suggestion-text"></span>
                                <div class="suggestion-loading"></div>
                            </div>
                        </div>
                        <div class="mb-3 input-with-suggestion">
                            <label for="posterTheme" class="form-label">Tema Poster</label>
                            <input type="text" class="form-control" id="posterTheme" placeholder="Contoh: Petualangan Tanpa Batas">
                            <small class="text-muted">Tema atau konsep utama untuk poster Anda. Saran AI akan relevan dengan produk di atas.</small>
                            <div class="suggestion-trigger">
                                <button type="button" class="btn btn-outline-info btn-sm btn-suggest-ai" data-target="posterTheme">
                                    <i class="fas fa-lightbulb me-1"></i> Saran AI
                                </button>
                            </div>
                            <div class="suggestion-area" id="suggestion-posterTheme">
                                <span class="suggestion-text"></span>
                                <div class="suggestion-loading"></div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kategori Poster</label>
                            <div class="poster-category-grid">
                                <div class="poster-category-item selected" data-category="makanan"><i class="fas fa-utensils me-1"></i> Makanan</div>
                                <div class="poster-category-item" data-category="minuman"><i class="fas fa-glass-cheers me-1"></i> Minuman</div>
                                <div class="poster-category-item" data-category="layanan"><i class="fas fa-concierge-bell me-1"></i> Layanan</div>
                                <div class="poster-category-item" data-category="produk"><i class="fas fa-shopping-bag me-1"></i> Produk</div>
                                <div class="poster-category-item" data-category="acara"><i class="fas fa-calendar-alt me-1"></i> Acara</div>
                                <div class="poster-category-item" data-category="promo"><i class="fas fa-tags me-1"></i> Promo</div>
                            </div>
                            <small class="text-muted">Pilih kategori yang paling sesuai dengan poster Anda.</small>
                        </div>
                        <div class="mb-3 input-with-suggestion">
                            <label for="posterText" class="form-label">Teks Promosi (Opsional)</label>
                            <input type="text" class="form-control" id="posterText" placeholder="Contoh: Rasakan Perbedaannya, Dapatkan Sekarang!">
                            <small class="text-muted">Teks singkat yang ingin ditampilkan di poster. Jika kosong, akan dibuatkan otomatis. Saran AI akan relevan dengan produk di atas.</small>
                            <div class="suggestion-trigger">
                                <button type="button" class="btn btn-outline-info btn-sm btn-suggest-ai" data-target="posterText">
                                    <i class="fas fa-lightbulb me-1"></i> Saran AI
                                </button>
                            </div>
                            <div class="suggestion-area" id="suggestion-posterText">
                                <span class="suggestion-text"></span>
                                <div class="suggestion-loading"></div>
                            </div>
                        </div>

                        <!-- NEW: Image Upload Section -->
                        <div class="mb-3">
                            <label for="posterImageUpload" class="form-label">Unggah Gambar Referensi (Opsional)</label>
                            <input class="form-control" type="file" id="posterImageUpload" accept="image/*">
                            <small class="text-muted">Unggah gambar untuk dianalisis dan dijadikan inspirasi gaya untuk prompt poster Anda. Jika diunggah, pilihan "Gaya Visual Poster" di bawah akan diabaikan.</small>
                            <div id="imagePreviewContainer" style="display: none; margin-top: 1rem; position: relative; max-width: 200px;">
                                <img id="imagePreview" src="#" alt="Pratinjau Gambar" style="width: 100%; border-radius: 8px;"/>
                                <button id="removeImageBtn" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-weight: bold; cursor: pointer; line-height: 25px; text-align: center; padding: 0;">&times;</button>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="posterStyle" class="form-label">Gaya Visual Poster (Jika tidak unggah gambar)</label>
                            <select class="form-select" id="posterStyle">
                                <option value="colorful">Warna-warni dan Menarik</option>
                                <option value="minimalist">Minimalis dan Elegan</option>
                                <option value="vintage">Vintage dan Retro</option>
                                <option value="modern">Modern dan Futuristik</option>
                                <option value="natural">Alami dan Organik</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-primary" id="generateBtn">
                    <i class="fas fa-magic me-2"></i> Generate Prompt
                </button>
            </div>
        </div>

        <div class="loading" id="loadingIndicator">
            <div class="loading-spinner"></div>
            <p class="mt-3">Sedang menghasilkan prompt...</p>
        </div>

        <div class="result-container" id="resultContainer">
            <div class="card">
                <h3 class="mb-4"><i class="fas fa-file-alt"></i> Hasil Prompt</h3>
                <div id="resultContent">
                    <!-- Results will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p>&copy; 2025 VDMAX PROMPT INDONESIA. Hak cipta dilindungi.</p>
            <p>Dibuat dengan <i class="fas fa-heart" style="color: #ff6b6b;"></i> untuk para kreator AI Indonesia</p>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State variable for image data
            let uploadedImageData = null;

            // Load API key from localStorage
            const savedApiKey = localStorage.getItem('geminiApiKey');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }

            // Toggle API key visibility
            document.getElementById('toggleApiKey').addEventListener('click', function() {
                const apiKeyInput = document.getElementById('apiKey');
                const toggleIcon = this.querySelector('i');
                if (apiKeyInput.type === 'password') {
                    apiKeyInput.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                } else {
                    apiKeyInput.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                }
            });

            // Save API key to localStorage
            document.getElementById('apiKey').addEventListener('change', function() {
                localStorage.setItem('geminiApiKey', this.value);
            });

            // Handle chip selection
            document.querySelectorAll('.specialization-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.specialization-chip').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Handle poster category selection
            document.querySelectorAll('.poster-category-item').forEach(category => {
                category.addEventListener('click', function() {
                    document.querySelectorAll('.poster-category-item').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Generate button click handler
            document.getElementById('generateBtn').addEventListener('click', generatePrompt);

            // AI Suggestion button listeners
            document.querySelectorAll('.btn-suggest-ai').forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.dataset.target;
                    getAISuggestion(targetId);
                });
            });

            // Clear suggestion when user types
            document.querySelectorAll('.input-with-suggestion input, .input-with-suggestion textarea').forEach(input => {
                input.addEventListener('input', function() {
                    clearAISuggestion(this.id);
                });
            });

            // --- NEW: Image Upload Handlers ---
            const posterImageUpload = document.getElementById('posterImageUpload');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const removeImageBtn = document.getElementById('removeImageBtn');

            posterImageUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imagePreview.src = e.target.result;
                        imagePreviewContainer.style.display = 'block';
                        uploadedImageData = {
                            mimeType: file.type,
                            data: e.target.result.split(',')[1] // Get Base64 data part
                        };
                        document.getElementById('posterStyle').disabled = true; // Disable style dropdown
                        showToast('Gambar referensi diunggah. Gaya visual akan diadaptasi dari gambar ini.', 'info');
                    }
                    reader.readAsDataURL(file);
                } else {
                    showToast('Silakan pilih file gambar yang valid.', 'error');
                    posterImageUpload.value = '';
                }
            });

            removeImageBtn.addEventListener('click', function() {
                posterImageUpload.value = '';
                imagePreview.src = '#';
                imagePreviewContainer.style.display = 'none';
                uploadedImageData = null;
                document.getElementById('posterStyle').disabled = false; // Re-enable style dropdown
            });

            function generatePrompt() {
                const apiKey = document.getElementById('apiKey').value.trim();
                const activeTab = document.querySelector('.nav-tabs .nav-link.active').id;

                if (!apiKey) {
                    showToast('Silakan masukkan kunci API Gemini Anda', 'error');
                    return;
                }

                if (activeTab === 'single-image-tab') {
                    generateSingleImagePrompt(apiKey);
                } else if (activeTab === 'poster-tab') {
                    generatePosterPrompt(apiKey);
                }
            }
            
            function generateSingleImagePrompt(apiKey) {
                const subject = document.getElementById('subject').value.trim();
                const negativePrompt = document.getElementById('negativePrompt').value.trim();
                const promptCount = document.getElementById('promptCount').value;
                const activeStyle = document.querySelector('.specialization-chip.active').dataset.style;

                if (!subject) {
                    showToast('Silakan masukkan subjek yang diinginkan', 'error');
                    return;
                }

                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('resultContainer').style.display = 'none';

                const geminiPrompt = buildGeminiPrompt(subject, activeStyle, promptCount, negativePrompt);

                callGeminiAPI(apiKey, geminiPrompt)
                    .then(response => {
                        displayResults(response, activeStyle, 'single');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast(`Terjadi kesalahan: ${error.message}`, 'error');
                    })
                    .finally(() => {
                        document.getElementById('loadingIndicator').style.display = 'none';
                    });
            }

            function generatePosterPrompt(apiKey) {
                const posterProduct = document.getElementById('posterProduct').value.trim();
                const posterTheme = document.getElementById('posterTheme').value.trim();
                const posterText = document.getElementById('posterText').value.trim();

                if (!posterProduct || !posterTheme) {
                    showToast('Produk/Jasa dan Tema Poster wajib diisi', 'error');
                    return;
                }

                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('resultContainer').style.display = 'none';

                if (uploadedImageData) {
                    // --- Image-to-Prompt Flow ---
                    const geminiPrompt = buildImageToPrompt(posterProduct, posterTheme, posterText);
                    callGeminiAPI(apiKey, geminiPrompt, uploadedImageData)
                        .then(response => displayResults(response, 'poster-from-image', 'poster'))
                        .catch(error => {
                            console.error('Error:', error);
                            showToast(`Terjadi kesalahan: ${error.message}`, 'error');
                        })
                        .finally(() => document.getElementById('loadingIndicator').style.display = 'none');
                } else {
                    // --- Text-Only Flow ---
                    const posterStyle = document.getElementById('posterStyle').value;
                    const selectedCategory = document.querySelector('.poster-category-item.selected').dataset.category;
                    const geminiPrompt = buildPosterPrompt(posterProduct, posterTheme, posterText, posterStyle, selectedCategory);
                    callGeminiAPI(apiKey, geminiPrompt)
                        .then(response => displayResults(response, 'poster', 'poster'))
                        .catch(error => {
                            console.error('Error:', error);
                            showToast(`Terjadi kesalahan: ${error.message}`, 'error');
                        })
                        .finally(() => document.getElementById('loadingIndicator').style.display = 'none');
                }
            }
            
            // --- NEW: Contextual AI Suggestion Logic ---
            async function getAISuggestion(targetId) {
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    showToast('Masukkan Kunci API Gemini untuk mendapatkan saran.', 'error');
                    return;
                }

                const suggestionArea = document.getElementById(`suggestion-${targetId}`);
                const suggestionTextElem = suggestionArea.querySelector('.suggestion-text');
                const loadingSpinner = suggestionArea.querySelector('.suggestion-loading');

                suggestionTextElem.innerHTML = '';
                loadingSpinner.style.display = 'block';
                suggestionArea.classList.add('active');

                const productContext = document.getElementById('posterProduct').value.trim();
                let promptForSuggestion = '';

                switch (targetId) {
                    case 'subject':
                        promptForSuggestion = `Berikan tiga hingga lima ide subjek fotorealistik dan menarik untuk gambar tunggal bergaya editorial/sinematik, cocok untuk AI image generator. Setiap ide harus spesifik dan menggambarkan adegan dengan jelas. Berikan ide-ide ini dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan atau pendahuluan.`;
                        break;
                    case 'negativePrompt':
                        promptForSuggestion = `Berikan daftar lima hingga tujuh kata kunci negatif yang paling efektif untuk menghindari cacat seperti anatomi yang salah, teks, tanda air, buram, atau kualitas rendah. Berikan hanya daftar kata kunci tersebut dalam bahasa Inggris (karena lebih efektif), dipisahkan dengan tanda koma. Jangan ada teks tambahan.`;
                        break;
                    case 'posterProduct':
                        promptForSuggestion = `Berikan tiga hingga lima nama produk atau jasa yang kreatif dan berkesan untuk poster promosi dari berbagai kategori (makanan, minuman, teknologi, fashion, layanan). Berikan dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan.`;
                        break;
                    case 'posterTheme':
                        promptForSuggestion = productContext ?
                            `Dengan produk utama "${productContext}", berikan tiga hingga lima ide tema poster promosi yang inovatif dan menarik secara visual. Tema harus menggambarkan konsep atau suasana. Berikan dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan.` :
                            `Berikan tiga hingga lima ide tema poster promosi yang inovatif dan menarik secara visual untuk berbagai produk/jasa. Tema harus menggambarkan konsep atau suasana. Berikan dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan.`;
                        break;
                    case 'posterText':
                        promptForSuggestion = productContext ?
                            `Dengan produk utama "${productContext}", berikan tiga hingga lima contoh slogan atau kalimat promosi singkat, persuasif, dan menarik untuk poster iklan. Berikan dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan.` :
                            `Berikan tiga hingga lima contoh slogan atau kalimat promosi singkat, persuasif, dan menarik untuk poster iklan komersial. Berikan dalam bahasa Indonesia, dipisahkan dengan tanda koma. Jangan ada teks tambahan.`;
                        break;
                    default:
                        loadingSpinner.style.display = 'none';
                        return;
                }

                try {
                    const suggestion = await callGeminiAPI(apiKey, promptForSuggestion);
                    const suggestionsArray = suggestion.split(',').map(s => s.trim().replace(/^"|"$/g, '')).filter(s => s); // Clean quotes and empty strings
                    
                    suggestionTextElem.innerHTML = ''; // Clear before adding new suggestions
                    if (suggestionsArray.length > 0) {
                        suggestionsArray.forEach(s => {
                            const span = document.createElement('span');
                            span.textContent = s;
                            span.addEventListener('click', () => {
                                document.getElementById(targetId).value = s;
                                clearAISuggestion(targetId);
                            });
                            suggestionTextElem.appendChild(span);
                        });
                        showToast('Saran AI berhasil didapatkan!', 'success');
                    } else {
                        suggestionTextElem.textContent = 'Tidak ada saran yang ditemukan.';
                    }
                } catch (error) {
                    console.error('Error fetching AI suggestion:', error);
                    showToast('Gagal mendapatkan saran AI. Periksa Kunci API Anda.', 'error');
                    suggestionArea.classList.remove('active');
                } finally {
                    loadingSpinner.style.display = 'none';
                }
            }
            
            function clearAISuggestion(targetId) {
                const suggestionArea = document.getElementById(`suggestion-${targetId}`);
                if (suggestionArea) {
                    suggestionArea.classList.remove('active');
                    suggestionArea.querySelector('.suggestion-text').innerHTML = '';
                    suggestionArea.querySelector('.suggestion-loading').style.display = 'none';
                }
            }

            // --- REVISED: Central API Call Function (Handles Text & Image) ---
            async function callGeminiAPI(apiKey, prompt, imageData = null) {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

                const parts = [{ text: prompt }];
                if (imageData) {
                    parts.push({
                        inline_data: {
                            mime_type: imageData.mimeType,
                            data: imageData.data
                        }
                    });
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: parts }],
                        // Add safety settings to reduce blocking
                        "safetySettings": [
                            {"category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_NONE"},
                            {"category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_NONE"},
                            {"category": "HARM_CATEGORY_SEXUALLY_EXPLICIT", "threshold": "BLOCK_NONE"},
                            {"category": "HARM_CATEGORY_DANGEROUS_CONTENT", "threshold": "BLOCK_NONE"}
                        ]
                    })
                });

                const responseData = await response.json();

                if (!response.ok) {
                    throw new Error(responseData.error?.message || 'Gagal berkomunikasi dengan API');
                }

                if (!responseData.candidates || responseData.candidates[0].finishReason === "SAFETY") {
                    throw new Error('Respons diblokir karena alasan keamanan. Coba ubah input Anda.');
                }
                
                if (!responseData.candidates[0].content || !responseData.candidates[0].content.parts) {
                     throw new Error('Respons API tidak valid atau kosong.');
                }

                let generatedText = responseData.candidates[0].content.parts[0].text;
                return generatedText.replace(/```(?:[a-z]+)?\n([\s\S]*?)```/g, '$1').trim();
            }

            // --- PROMPT ENGINEERING LOGIC ---
            function buildGeminiPrompt(subject, style, count, negativePrompt) {
                let basePrompt = `#ROLE You are "ROEMAH PROMPT INDONESIA", an elite prompt-engineering savant for hyper-realistic, professional magazine imagery. Your specialty is creating prompts for AI Image Generators that result in Vogue-worthy, editorial-style photos. #SPECIALIZATION You know all the hidden secrets, tips, and tricks for extreme photorealism, professional photoshoots, and award-winning photography. You utilize keywords for high-end cameras like Hasselblad, Canon, Leica, and Sony. #GOAL Generate extraordinary and unique AI image prompts, including print styles, magazines, editorial keywords, famous photographers, etc. #PROMPT STRUCTURE MUST INCLUDE: Professional camera and lens (e.g., Canon R5 with 85mm f/1.2, Leica SL2, Phase One IQ4). Specific directional lighting setup (e.g., soft golden hour, backlight rim, beauty dish). Subject styling, background details (e.g., soft grey backdrop, blurred bokeh), and emotional tone. Output specs: cinematic 16:9, photorealistic, ultra HD, editorial finish. #RESPONSE STYLE Write in dense paragraph form (no bullet points), ready for copy-pasting. #SPECIALIZATION ADDITION Your expertise now includes: Netflix tone, Korean Drama style, K-Pop aesthetic, Hollywood glamour, ESPN sports action, and National Geographic documentary style. #ADVANCED PROMPT STRUCTURE MUST INCLUDE: camera body/lens, focal length/aperture, lighting, subject styling, background/location, emotions, makeup/hair stylist credits, photographer credit, specific color grading, and theme packs. #TASK Create ${count} ready-to-use prompts for the subject: "${subject}". Each prompt must be in the style of "${style}", using all elements from the advanced structure and relevant hidden keywords.`;
                if (negativePrompt) {
                    basePrompt += `\n#NEGATIVE_PROMPT\nEnsure the image avoids: ${negativePrompt}. Specifically, no watermarks, text, blurry elements, or physical deformities.`;
                }
                return basePrompt;
            }

            function buildPosterPrompt(product, theme, text, style, category) {
                const styleDescriptions = {'colorful': 'vibrant, high-contrast, and eye-catching','minimalist': 'minimalist, elegant, with ample negative space and clean typography','vintage': 'vintage and retro, using old film textures and faded colors','modern': 'modern, sleek, and futuristic with bold geometric shapes','natural': 'natural and organic, featuring earthy tones and nature-inspired elements'};
                const finalPromotionalText = text;
                return `#ROLE\nYou are "PROMPT STUDIO ID", an expert prompt engineer for hyper-realistic commercial advertising posters for the Indonesian market.\n\n#OBJECTIVE\nGenerate ONE expert-level prompt for an AI image generator to create a professional advertising poster.\n\n#INPUTS\n- Product Name: "${product}"\n- Poster Theme: "${theme}"\n- Promotional Text: "${finalPromotionalText}" (If empty, create a compelling one in Indonesian).\n- Visual Style: ${styleDescriptions[style]}\n- Category: ${category}\n\n#PROMPT STRUCTURE (STRICTLY FOLLOW THIS):\nCreate a single, dense paragraph. Start with the overall scene and composition. Describe the main product, "${product}", in irresistible detail, making it the clear hero and focal point. Describe the background and atmosphere to support the theme. Specify the ${styleDescriptions[style]} style through color palette and design elements. **Crucially, instruct the AI to render the following text directly on the poster (DO NOT TRANSLATE):** The main headline text must be '${product}' (largest, boldest font). The secondary call-to-action text should be '${finalPromotionalText}'. A smaller, elegant tagline text should be '${theme}'. Specify professional lighting (e.g., 'dramatic studio lighting with a soft key light') to make the product pop. End with essential keywords: "commercial product photography, advertising poster, hyper-realistic, ultra-detailed, sharp focus, 8K, professional color grading, editorial quality, Indonesian market".\n\n#TASK\nCreate the single, comprehensive prompt based on all rules and inputs.`;
            }

            function buildImageToPrompt(product, theme, text) {
                const finalPromotionalText = text;
                return `#ROLE\nYou are a "VISUAL PROMPT ARCHITECT", an AI expert analyzing a reference image to create a new, professional advertising poster prompt.\n\n#OBJECTIVE\nAnalyze the provided image. Generate ONE expert-level prompt for a new poster that masterfully adapts the *visual style, color palette, lighting, and composition* of the reference image, but features the *new product and text* specified by the user.\n\n#CRITICAL INSTRUCTIONS\n1.  **Analyze and Adapt, Don't Copy:** Your primary task is to understand the *essence* of the reference image (e.g., is it dark and moody? bright and airy? minimalist? cluttered and energetic?) and apply that essence to the new prompt. Do not describe the old subject.\n2.  **New Hero Subject:** The new main subject is "${product}". It must be the focal point.\n3.  **New Text:** You must use the new text provided. Do not use any text from the reference image.\n\n#PROMPT STRUCTURE (STRICTLY FOLLOW THIS):\nCreate a single, dense paragraph. Begin by describing the overall composition and atmosphere for a new poster, heavily inspired by the reference image's style. Then, describe the new main product, "${product}", positioned as the hero of the shot, detailed to look highly appealing. The background, lighting scheme (e.g., 'soft, diffused side-lighting'), and color palette should be directly inspired by the provided image. **Crucially, instruct the AI to render the following NEW text on the poster (DO NOT TRANSLATE):** The Main Headline text must be '${product}' (in a very large, dominant font). The secondary Call-to-Action text should be '${finalPromotionalText}'. A smaller, subtle Tagline text should be '${theme}'. Conclude with essential keywords: "commercial product photography, advertising poster, hyper-realistic, ultra-detailed, sharp focus, 8K, professional color grading, editorial quality, style adapted from a visual reference".\n\n#TASK\nAnalyze the provided image and user's text inputs. Create the single, comprehensive prompt following all rules.`;
            }

            function displayResults(response, style, type) {
                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = '';

                if (type === 'single') {
                    const prompts = response.split(/Prompt \d+:/).filter(p => p.trim());
                    prompts.forEach((prompt, index) => {
                        createResultBox(`Prompt ${index + 1} - Gaya ${getStyleName(style)}`, prompt.trim());
                    });
                } else if (type === 'poster') {
                    const title = style === 'poster-from-image' ?
                        '<i class="fas fa-camera-retro me-2"></i> Prompt Poster (dari Gambar)' :
                        '<i class="fas fa-ad me-2"></i> Prompt Poster Profesional';
                    createResultBox(title, response.trim());
                }
                
                document.getElementById('resultContainer').style.display = 'block';
                document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
                showToast('Prompt berhasil dihasilkan!', 'success');
            }

            function createResultBox(titleText, contentText) {
                const resultContent = document.getElementById('resultContent');
                const resultHeader = document.createElement('div');
                resultHeader.className = 'result-header';
                
                const resultTitle = document.createElement('div');
                resultTitle.className = 'result-title';
                resultTitle.innerHTML = titleText;

                const copyButton = document.createElement('button');
                copyButton.className = 'btn btn-sm btn-copy';
                copyButton.innerHTML = '<i class="fas fa-copy"></i> Salin';
                copyButton.addEventListener('click', () => copyToClipboard(contentText));
                
                resultHeader.appendChild(resultTitle);
                resultHeader.appendChild(copyButton);

                const resultBox = document.createElement('div');
                resultBox.className = 'result-box';
                resultBox.textContent = contentText;

                const promptContainer = document.createElement('div');
                promptContainer.appendChild(resultHeader);
                promptContainer.appendChild(resultBox);
                resultContent.appendChild(promptContainer);
            }

            function getStyleName(style) {
                const names = {'magazine': 'Magazine','netflix': 'Netflix','korean': 'Korean Drama','kpop': 'K-Pop','hollywood': 'Hollywood','espn': 'ESPN','natgeo': 'National Geographic'};
                return names[style] || style;
            }

            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Prompt berhasil disalin!', 'success');
                }).catch(err => {
                    showToast('Gagal menyalin prompt.', 'error');
                });
            }

            function showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = 'custom-toast';
                
                if (type === 'error') {
                    toast.style.backgroundColor = '#f44336';
                    toast.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i> ${message}`;
                } else if (type === 'info') {
                     toast.style.backgroundColor = '#2196F3'; // Blue for info
                     toast.innerHTML = `<i class="fas fa-info-circle me-2"></i> ${message}`;
                } else {
                    toast.innerHTML = `<i class="fas fa-check-circle me-2"></i> ${message}`;
                }

                toastContainer.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }, 4000); // Increased duration for info toasts
            }
        });
    </script>
</body>
</html>
